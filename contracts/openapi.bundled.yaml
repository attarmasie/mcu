openapi: 3.0.3
info:
  title: Backend API
  description: RESTful API with authentication
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
servers:
  - url: 'http://localhost:8080/api/v1'
    description: Development server
  - url: 'https://api.example.com/v1'
    description: Production server
tags:
  - name: auth
    description: Authentication endpoints
  - name: users
    description: User management
  - name: patients
    description: Patient management
paths:
  /auth/register:
    post:
      operationId: register
      summary: Register new user
      description: Create a new user account with email and password
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              name: John Doe
              email: john@example.com
              password: password123
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                user:
                  id: 123e4567-e89b-12d3-a456-426614174000
                  name: John Doe
                  email: john@example.com
                  role: admin
                  is_active: true
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
  /auth/login:
    post:
      operationId: login
      summary: Login user
      description: Authenticate user and return JWT token
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: john@example.com
              password: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                user:
                  id: 123e4567-e89b-12d3-a456-426614174000
                  name: John Doe
                  email: john@example.com
                  role: admin
                  is_active: true
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/me:
    get:
      operationId: getCurrentUser
      summary: Get current user
      description: Get current authenticated user information
      tags:
        - auth
      security:
        - BearerAuth:
            - doctor
            - admin
            - operator
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponse'
              example:
                user_id: 123e4567-e89b-12d3-a456-426614174000
                email: john@example.com
                role: admin
        '401':
          $ref: '#/components/responses/Unauthorized'
  /users:
    get:
      operationId: listUsers
      summary: Get all users
      description: Retrieve a paginated list of users
      tags:
        - users
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      operationId: createUser
      summary: Create new user
      description: Create a new user (admin only)
      tags:
        - users
      security:
        - BearerAuth:
            - admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  '/users/{id}':
    get:
      operationId: getUser
      summary: Get user by ID
      description: Retrieve a specific user by UUID
      tags:
        - users
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      operationId: updateUser
      summary: Update user
      description: Update an existing user
      tags:
        - users
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      operationId: deleteUser
      summary: Delete user
      description: Delete a user
      tags:
        - users
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '204':
          description: User deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /patients:
    get:
      operationId: listPatients
      summary: Get all patients
      description: Retrieve a paginated list of patients
      tags:
        - patients
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - $ref: '#/components/parameters/SearchParam'
        - $ref: '#/components/parameters/PatientGenderParam'
        - $ref: '#/components/parameters/PatientTypeParam'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Patient'
                  meta:
                    $ref: '#/components/schemas/Meta'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      operationId: createPatient
      summary: Create new patient
      description: Create a new patient
      tags:
        - patients
      security:
        - BearerAuth:
            - admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
      responses:
        '201':
          description: Patient created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Patient'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  '/patients/{id}':
    get:
      operationId: getPatient
      summary: Get patient by ID
      description: Retrieve a specific patient by UUID
      tags:
        - patients
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Patient'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      operationId: updatePatient
      summary: Update patient
      description: Update an existing patient
      tags:
        - patients
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePatientRequest'
      responses:
        '200':
          description: Patient updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Patient'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      operationId: deletePatient
      summary: Delete patient
      description: Delete a patient
      tags:
        - patients
      security:
        - BearerAuth:
            - admin
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '204':
          description: Patient deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
components:
  parameters:
    PageParam:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number
    PerPageParam:
      name: per_page
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 10
      description: Items per page
    IdParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
      description: Resource UUID
      example: 123e4567-e89b-12d3-a456-426614174000
    SearchParam:
      name: search
      in: query
      schema:
        type: string
      description: Search query
    PatientGenderParam:
      name: gender
      in: query
      schema:
        type: string
        enum:
          - male
          - female
          - other
      description: Filter by gender
    PatientTypeParam:
      name: patient_type
      in: query
      schema:
        type: string
        enum:
          - teacher
          - student
          - general
      description: Filter by patient type
  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Invalid input
            code: BAD_REQUEST
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Authentication required
            code: UNAUTHORIZED
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Resource not found
            code: NOT_FOUND
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Access denied
            code: FORBIDDEN
    Conflict:
      description: Conflict - Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Email already registered
            code: CONFLICT
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            message: Internal server error
            code: INTERNAL_ERROR
  schemas:
    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          example: Invalid input
        code:
          type: string
          example: INVALID_INPUT
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
    Meta:
      type: object
      properties:
        page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 10
        total:
          type: integer
          example: 100
        total_pages:
          type: integer
          example: 10
    PaginationParams:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          default: 1
        per_page:
          type: integer
          minimum: 1
          maximum: 100
          default: 10
    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: John Doe
          description: Full name of the user
        email:
          type: string
          format: email
          example: john@example.com
          description: Valid email address
        password:
          type: string
          format: password
          minLength: 6
          example: password123
          description: Password (minimum 6 characters)
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: john@example.com
          description: User email address
        password:
          type: string
          format: password
          example: password123
          description: User password
    AuthResponse:
      type: object
      required:
        - token
        - user
      properties:
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
          description: JWT authentication token
        user:
          $ref: '#/components/schemas/UserData'
    UserData:
      type: object
      required:
        - id
        - name
        - email
        - role
        - is_active
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
          description: User UUID
        name:
          type: string
          example: John Doe
          description: User's full name
        email:
          type: string
          format: email
          example: john@example.com
          description: User's email address
        role:
          type: string
          enum:
            - admin
            - doctor
            - operator
          example: admin
          description: User role
        is_active:
          type: boolean
          example: true
          description: Whether the user account is active
    MeResponse:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
          description: Current user UUID
        email:
          type: string
          format: email
          example: john@example.com
          description: Current user email
        role:
          type: string
          example: admin
          description: Current user role
    User:
      type: object
      required:
        - id
        - name
        - email
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
          description: User UUID
        name:
          type: string
          example: John Doe
          minLength: 2
          maxLength: 100
          description: User's full name
        email:
          type: string
          format: email
          example: john@example.com
          description: User's email address
        role:
          type: string
          enum:
            - admin
            - doctor
            - operator
          default: doctor
          description: User role
        is_active:
          type: boolean
          default: true
          description: Whether the user is active
        created_at:
          type: string
          format: date-time
          description: User creation timestamp
        updated_at:
          type: string
          format: date-time
          description: User last update timestamp
    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
          example: John Doe
        email:
          type: string
          format: email
          example: john@example.com
        password:
          type: string
          format: password
          minLength: 6
          example: password123
          description: User password (will be hashed)
        role:
          type: string
          enum:
            - admin
            - doctor
            - operator
          default: doctor
    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 100
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 6
          description: 'New password (optional, will be hashed)'
        role:
          type: string
          enum:
            - admin
            - doctor
            - operator
        is_active:
          type: boolean
    Patient:
      type: object
      required:
        - id
        - full_name
        - date_of_birth
        - gender
        - patient_type
        - phone_number
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
          description: Patient UUID
        full_name:
          type: string
          example: John Doe
          minLength: 2
          maxLength: 255
          description: Patient full name
        date_of_birth:
          type: string
          format: date
          example: '1990-01-15'
          description: Patient date of birth
        gender:
          type: string
          enum:
            - male
            - female
            - other
          example: male
          description: Patient gender
        patient_type:
          type: string
          enum:
            - teacher
            - student
            - general
          example: general
          description: 'Patient type (teacher, student, or general)'
        phone_number:
          type: string
          example: '+62812345678'
          description: Patient phone number
        email:
          type: string
          format: email
          nullable: true
          example: patient@example.com
          description: Patient email address
        address:
          type: string
          nullable: true
          example: 'Jl. Contoh No. 123, Jakarta'
          description: Patient address
        medical_record_number:
          type: string
          nullable: true
          example: MR-2024-001
          description: Medical record number
        emergency_contact_name:
          type: string
          nullable: true
          example: Jane Doe
          description: Emergency contact name
        emergency_contact_phone:
          type: string
          nullable: true
          example: '+62812345679'
          description: Emergency contact phone
        blood_type:
          type: string
          nullable: true
          enum:
            - A+
            - A-
            - B+
            - B-
            - AB+
            - AB-
            - O+
            - O-
          example: O+
          description: Patient blood type
        allergies:
          type: string
          nullable: true
          example: 'Penicillin, Peanuts'
          description: Known allergies
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
    CreatePatientRequest:
      type: object
      required:
        - full_name
        - date_of_birth
        - gender
        - patient_type
        - phone_number
      properties:
        full_name:
          type: string
          minLength: 2
          maxLength: 255
          example: John Doe
        date_of_birth:
          type: string
          format: date
          example: '1990-01-15'
        gender:
          type: string
          enum:
            - male
            - female
            - other
          example: male
        patient_type:
          type: string
          enum:
            - teacher
            - student
            - general
          example: general
        phone_number:
          type: string
          example: '+62812345678'
        email:
          type: string
          format: email
          nullable: true
          example: patient@example.com
        address:
          type: string
          nullable: true
          example: 'Jl. Contoh No. 123, Jakarta'
        medical_record_number:
          type: string
          nullable: true
          example: MR-2024-001
        emergency_contact_name:
          type: string
          nullable: true
          example: Jane Doe
        emergency_contact_phone:
          type: string
          nullable: true
          example: '+62812345679'
        blood_type:
          type: string
          nullable: true
          enum:
            - A+
            - A-
            - B+
            - B-
            - AB+
            - AB-
            - O+
            - O-
          example: O+
        allergies:
          type: string
          nullable: true
          example: 'Penicillin, Peanuts'
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
